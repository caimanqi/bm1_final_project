---
title: "Final_project_bm"
author: "Manqi Cai"
date: "12/9/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The Data Analytics group from Good Health Corporation are interested in improving the overall hospital management and minimizing the cost/resources associated with patients’ care. One of the most important outcomes that has a direct effect on these aspects is patient’s length of stay (LoS) in the hospital. Thus, they would like to know which variables are associated with LoS, and ultimately build a predictive model to be used for future visits. The group has contacted you to study this problem and make a recommendation.

```{r}
library(tidyverse)
library(readxl)
library(dplyr)
library(DT)
library(janitor)
```

#load data set
```{r}
ghproject <- read_excel("GHProject_Dataset.xlsx") %>% 
  clean_names()

#summary of continuous variable
ghproject %>% 
  select(losdays2, evisit, ageyear, bmi:facilityzip) %>% 
  summary() %>% 
  na.omit() %>% 
  knitr::kable()

#summary of categorical data
ghproject %>% 
  select()

#summary of PatientID and VisitID
ghproject %>% 
  distinct(patientid) %>% 
  count()

ghproject %>% 
  distinct(visitid) %>% 
  count()

```
There are 3682 records from 3612 patients

```{r remove duplicated patients}
n_occur <- data.frame(table(ghproject$patientid))
#check the duplicated patients
revisit_patient <- ghproject[ghproject$patientid %in% n_occur$Var1[n_occur$Freq > 1],]

#remove duplicated patients
ghproject_remove <- ghproject[!duplicated(ghproject[c('patientid')]),]

##recode gender
ghproject_tidy <- ghproject_remove %>% 
  mutate(gender = ifelse(gender == "Male", "1","0" )) %>% 
  mutate(maritalstatus = ifelse(maritalstatus == "Married","1","0"),
         cindex = recode(cindex,
                         "0" = "0",
                         "1" = "0",
                         "2" = "1",
                         "3" = "1",
                         "4" = "2",
                         "5" = "2"),
         insurancetype = recode(insurancetype,
                                "NA" = "0",
                                "Private" = "1",
                                "Medicare" = "2",
                                "Medicaid" = "2"),
         religion = ifelse(religion == "No Affiliation", "0", "1"),
         losdays2_log = log(losdays2),
         id = 1:nrow(ghproject_tidy)) %>% 
  select(-(bmi:facilityzip), -facilityname,-admitdtm,-loshours,-postalcode,-race,-visitid,-patientid) %>% 
  select(id,everything())

```

